(function(h){var e;h.fn.feedback=function(l){e=h.extend({main:"feedback",closeLink:"feedback_close_link",modalWindow:"feedback_modal_window",modalContent:"feedback_modal_content",form:"feedback_form",formUrl:"/feedbacks/new",overlay:"feedback_overlay",loadingImage:"/images/feedback/loading.gif",loadingText:"Loading...",sendingText:"Sending...",tabPosition:"left"},l||{});e.feedbackHtml='<div id="'+e.main+'" style="display: none;"><div id="'+e.modalWindow+'"><a href="#" id="'+e.closeLink+'"></a><div id="'+e.modalContent+'"></div></div></div>';e.overlayHtml='<div id="'+e.overlay+'" class="feedback_hide"></div>';e.tabHtml='<a href="#" id="feedback_link" class="feedback_link '+e.tabPosition+'"></a>';e.main="#"+e.main;e.closeLink="#"+e.closeLink;e.modalWindow="#"+e.modalWindow;e.modalContent="#"+e.modalContent;e.form="#"+e.form;e.overlay="#"+e.overlay;e.tabControls=this;if(e.tabPosition!=null&&h("#feedback_link").length==0){h("body").append(e.tabHtml);e.tabControls=h(e.tabControls).add(h("#feedback_link"));}h(e.tabControls).click(function(){d();h(e.modalContent).load(e.formUrl,null,function(){h(e.form).submit(c);});return false;});};var c=function(){var m=h(e.form).serialize();var l=h.trim(h(e.form).attr("action"));d(e.sendingText);h.ajax({type:"POST",url:l,data:m,success:function(o,n){h(e.modalContent).html(o);h(e.modalWindow).fadeOut(2000,function(){g();});},error:function(p,o,n){h(e.modalContent).html(p.responseText);h(e.form).submit(c);}});return false;};var i=function(){if(h(e.overlay).length==0){h("body").append(e.overlayHtml);}return h(e.overlay).hide().addClass("feedback_overlayBG");};var b=function(){i().show();};var a=function(){if(h(e.overlay).length==0){return false;}h(e.overlay).remove();};var f=function(){if(h(e.main).length==0){h("body").append(e.feedbackHtml);h(e.closeLink).click(function(){g();return false;});k();}return h(e.main);};var j=function(){f().show();};var g=function(){h(e.main).hide();h(e.main).remove();a();};var k=function(){var m,l;if(self.pageYOffset){m=self.pageYOffset;}else{if(document.documentElement&&document.documentElement.scrollTop){m=document.documentElement.scrollTop;}else{if(document.body){m=document.body.scrollTop;}}}if(self.innerHeight){l=self.innerHeight;}else{if(document.documentElement&&document.documentElement.clientHeight){l=document.documentElement.clientHeight;}else{if(document.body){l=document.body.clientHeight;}}}h(e.modalWindow).css({top:m+(l/10)+"px"});};var d=function(l){b();f();if(l==null){l=e.loadingText;}h(e.modalContent).html("<h1>"+l+'<img src="'+e.loadingImage+'" /></h1>');j();};})(jQuery);